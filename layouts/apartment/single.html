{{ define "main" }}
{{ $aptID := .Params.apartment_id }}
{{ $aptData := index .Site.Data.apartments $aptID }}

<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">

  {{/* Breadcrumb */}}
  <div class="flex items-center gap-2 text-sm text-stone-400 mb-4">
    <a href="{{ .Site.Home.RelPermalink }}" class="hover:text-lake">Home</a>
    <span>/</span>
    <span>{{ .Title }}</span>
  </div>

  <h1 class="text-4xl font-bold text-stone-900 mb-4">{{ .Title }}</h1>
  {{ with .Description }}
  <p class="text-xl text-stone-600 leading-relaxed mb-8">{{ . }}</p>
  {{ end }}

  {{/* Photo gallery */}}
  {{ $images := .Resources.Match "images/*.{jpg,jpeg,png,webp}" }}
  {{ if $images }}
  <div class="mb-10">
    {{ $hero := (index $images 0).Fill "1200x600 q90 Lanczos" }}
    {{ $heroFull := (index $images 0).Fit "1600x1200 q90 Lanczos" }}
    <a href="{{ $heroFull.RelPermalink }}"
       class="glightbox block rounded-2xl overflow-hidden aspect-[2/1]"
       data-gallery="{{ $aptID }}">
      <img src="{{ $hero.RelPermalink }}"
           width="{{ $hero.Width }}" height="{{ $hero.Height }}"
           alt="{{ .Title }}"
           class="w-full h-full object-cover">
    </a>
    {{ if gt (len $images) 1 }}
    <div class="mt-2 grid grid-cols-4 gap-2">
      {{ range after 1 $images | first 4 }}
      {{ $thumb := .Fill "400x250 q85 Lanczos" }}
      {{ $full := .Fit "1600x1200 q90 Lanczos" }}
      <a href="{{ $full.RelPermalink }}"
         class="glightbox block rounded-lg overflow-hidden aspect-[8/5]"
         data-gallery="{{ $aptID }}">
        <img src="{{ $thumb.RelPermalink }}"
             width="{{ $thumb.Width }}" height="{{ $thumb.Height }}"
             alt="{{ $.Title }}"
             loading="lazy"
             class="w-full h-full object-cover hover:scale-105 transition-transform duration-300">
      </a>
      {{ end }}
    </div>
    {{ end }}
  </div>
  {{ end }}

  {{/* Main content */}}
  <div class="prose prose-stone max-w-none mb-8">
    {{ .Content }}
  </div>

  {{/* Features */}}
  {{ if $aptData }}
    {{ partial "apartment-features.html" (dict "apt" $aptData) }}
    {{ partial "pricing-table.html" (dict "apt" $aptData) }}
  {{ end }}

  {{/* CTA */}}
  <div class="mt-12 p-6 bg-lake/5 border border-lake/20 rounded-2xl text-center">
    <h3 class="text-xl font-semibold text-stone-900 mb-2">{{ i18n "nav_interested" }}</h3>
    <p class="text-stone-600 mb-4">{{ i18n "nav_interested_text" }}</p>
    <div class="flex flex-wrap gap-3 justify-center">
      {{ range where .Site.RegularPages ".Params.translationKey" "availability" }}
      <a href="{{ .RelPermalink }}"
         class="px-6 py-3 rounded-lg bg-lake text-white font-medium hover:bg-lake-dark transition-colors">
        {{ i18n "nav_check_availability" }}
      </a>
      {{ end }}
      {{ range where .Site.RegularPages ".Params.translationKey" "contact" }}
      <a href="{{ .RelPermalink }}"
         class="px-6 py-3 rounded-lg border border-lake text-lake font-medium hover:bg-lake hover:text-white transition-colors">
        {{ i18n "nav_contact_us" }}
      </a>
      {{ end }}
    </div>
  </div>

</div>
{{ end }}

{{ define "scripts" }}
<script src="https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js"></script>
<script>
  GLightbox({ selector: '.glightbox', touchNavigation: true, loop: true });
</script>
{{ end }}
